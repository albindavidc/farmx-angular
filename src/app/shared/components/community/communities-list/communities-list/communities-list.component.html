<div class="communities-container">
  <h1>Communities</h1>

  <div *ngIf="loading$ | async" class="loading-container">
    <mat-spinner diameter="40"></mat-spinner>
  </div>

  <div
    *ngIf="(communities$ | async)?.length === 0 && !(loading$ | async)"
    class="no-communities"
  >
    <p>No communities available.</p>
  </div>

  <div class="communities-grid">
    <mat-card
      *ngFor="let community of communities$ | async"
      class="community-card"
    >
      <div class="community-image">
        <img [src]="community.imageUrl" alt="{{ community.name }}" />
      </div>

      <div class="community-placeholder" *ngIf="!community.imageUrl">
        <mat-icon>groups</mat-icon>
      </div>

      <mat-card-content>
        <h2>{{ community.name }}</h2>

        <p class="description">{{ community.description }}</p>

        <div class="community-meta">
          <span class="members">
            <mat-icon>person</mat-icon> {{ community.memberCount }} members
          </span>

          <div *ngIf="community.categories?.length" class="categories">
            <span
              *ngFor="let category of community.categories"
              class="category-tag"
            >
              {{ category }}
            </span>
          </div>
        </div>
      </mat-card-content>

      <mat-card-actions>
        <button
          mat-button
          color="var(--md-sys-color-primary)"
          [routerLink]="['/communities', community.id]"
        >
          View Community
        </button>

        <ng-container *ngIf="isCommunityJoined() | async; else joinBlock">
          <button
            mat-button
            color="warn"
            (click)="leaveCommunity(community.id)"
          >
            Leave
          </button>
        </ng-container>

        <ng-template #joinBlock>
          <button
            mat-button
            color="var(--md-sys-color-primary)"
            (click)="joinCommunity(community.id)"
          >
            Join
          </button>
        </ng-template>
      </mat-card-actions>
    </mat-card>
  </div>
</div>
